<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Promethee.GitHub.io by promethee</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <link rel="stylesheet" href="css/gist.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown.js/0.5.0/markdown.min.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Promethee.GitHub.io</h1>
        <p><img src="https://travis-ci.org/promethee/promethee.github.io.svg?branch=master"/></p>
        <p class="view"><a href="https://github.com/promethee">View My GitHub Profile</a></p>
        <p>
          <ul>
            <li><strong><a href="http://promethee.github.io/url2qrcode/" target="_blank">qr2url</a></strong> : Think "unplugged url sharing"</li>
          </ul>
        </p>

      </header>
      <section></section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <!-- <script src="javascripts/posts.js"></script> -->
    <script type="text/JavaScript">
      var gists = {};
      var posts = {};
      var tags = {};

      var addGist = function (gist) {
          var p_container = document.createElement('p');
          p_container.dataset.gistId = gist.id;
          p_container.style.display = 'block';

          var div_gist = document.createElement('div');
          div_gist.className = 'gist';
          div_gist.dataset.description = gist.description || '';

          var div_gist_date = document.createElement('small');
          div_gist_date.className = 'gitst-date'
          div_gist_date.innerHTML = moment(gist.created_at).format('dddd MMMM Do YYYY [@] H:m');

          var div_gist_content = document.createElement('p');
          div_gist_content.className = 'gist-content';
          div_gist_content.innerHTML = markdown.toHTML(gist.data);

          var _tags = gist.description.split('#');
          _tags.filter(function (tag) {
            // return -1 < tag.indexOf('#') ? tag.substr(1):tag;
            if (tag.length)   return tag.substr(1);
          }).map(function (tag) {
            if (undefined === tags[tag]) {
              tags[tag] = 0;
            }
            tags[tag] += 1;
          });
          var div_gist_tags = document.createElement('small');
          div_gist_tags.className = 'gist-tags';
          div_gist_tags.innerHTML = _tags.join(' ');

          div_gist.appendChild(div_gist_date);
          div_gist.appendChild(div_gist_content);
          div_gist.appendChild(div_gist_tags);
          p_container.appendChild(div_gist);
          document.getElementsByTagName('section')[0].appendChild(p_container);
      };

      var getGist = function (url, callback) {
          $.get(url, callback);
      };

      var onGistListDone = function (gists) {
          gists.map(function (gist) {
              posts[gist.created_at] = gist;
          });

          var creation_dates = Object.keys(posts).sort().reverse();
          creation_dates.map(function (creation_date) {
              Object.keys(posts[creation_date].files).map(function (filename) {
                  var gist_file = posts[creation_date].files[filename];
                  getGist(gist_file.raw_url, function (data) {
                      posts[creation_date].data = data;
                      addGist(posts[creation_date]);
                  });
              });
              return posts[creation_date];
          });
      };

      var getGistList = function (callback) {
          console.log('gists', gists);
          $.get('https://api.github.com/users/promethee/gists', callback || onGistListDone);
      };

      getGistList();
    </script>
  </body>
</html>
